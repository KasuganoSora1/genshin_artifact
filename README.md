# genshin_aritfact
分析原神圣遗物升级的分数期望，算法使用的为提瓦特小助手的算法。
### 新的期望算法
**$i$**:第几个参数;&nbsp;&nbsp;**$j$**:加几次;&nbsp;&nbsp;**$k$**:加多少
$$
E=\sum_{i,j,k} (p_jp_ka_iC^{ijk})\\
=\sum_{i,j,k} (p_jp_kS^{jk})\\
\sum_{i} a_iC^{ijk}=S^{jk}\\
\sum_{k}p_kE^{jk}=E^j\\
E=\sum_{j}p_jE^j
$$

快速计算$E^j$就能简化期望计算

$$
E^j=\sum_{k}p_kS^{jk}\\
=\sum_kp_k\sum_ia_iC^{ijk} (i=\{1,2,3,4\})\\
=\sum_kp_k(a_1C^{1jk}+a_2C^{2jk}+a_3C^{3jk}+a_4C^{4jk})
$$

$N=4^n$是可能的总数，$n_i$是第i种可能的数量，$p_i$是概率

$$
E^j=\sum_k \frac{1}{4^n}(a_1C^{1jk}+a_2C^{2jk}+a_3C^{3jk}+a_4C^{4jk})\\
=\sum_k\frac{1}{4^n}a_1C^{1jk}+\sum_k\frac{1}{4^n}a_2C^{2jk}+\sum_k\frac{1}{4^n}a_3C^{3jk}+\sum_k\frac{1}{4^n}a_4C^{4jk}
$$


当$a_i$为加了1个 $\frac{0.7+0.8+0.9+1.0}{2}=0.85$
当$a_i$为加了2个 所有情况
$$
(0.7,0.7)(0.7,0.8)(0.7,0.9)(0.7,1.0)\\
(0.8,0.7)(0.8,0.8)(0.8,0.9)(0.8,1.0)\\
(0.9,0.7)(0.9,0.8)(0.9,0.9)(0.9,1.0)\\
(1.0,0.7)(1.0,0.8)(1.0,0.9)(1.0,1.0)\\
\sum=1.7
$$
当$a_i$为加了3个 所有情况 $\sum=2.55$
当$a_i$为加了4个 所有情况 $\sum=3.4$
当$a_i$为加了5个 所有情况 $\sum=4.25$

###  概率$p_j$算法
假设现在加5次,总共有多少种情况$N=4^5=2^{10}=1024$
合并相同的加法,总共有多少种情况
$$
N'=C_4^1+C_4^2*C_4^1+C_4^3*C_4^2+C_4^4*C_4^3=56
$$
验证
$$
C_4^1\times 1=4 \\
(1,4) \quad \frac{5!}{1!4!}=5\\
\quad\\
(2,3) \quad \frac{5!}{2!3!}=10\\
\quad\\
(3,2) \quad \frac{5!}{3!2!}=10\\
\quad\\
(4,1) \quad \frac{5!}{4!1!}=5\\
\quad\\
C_4^2 \times 28=6 \times 30=180
\quad\\
(1,1,3) \quad \frac{5!}{1!1!3!}=20\\
\quad\\
(1,2,2) \quad \frac{5!}{1!2!2!}=30\\
\quad\\
(1,3,1) \quad \frac{5!}{1!3!1!}=20\\
\quad\\
(2,1,2) \quad \frac{5!}{2!1!2!}=30\\
\quad\\
(2,2,1) \quad \frac{5!}{2!2!1!}=30\\
\quad\\
(3,1,1) \quad \frac{5!}{3!1!1!}=20\\
\quad\\
C_4^3 \times 150=4 \times 150=600
\quad\\
(1,1,1,2) \quad \frac{5!}{1!1!1!2!}=60\\
\quad\\
(1,1,2,1) \quad \frac{5!}{1!1!2!1!}=60\\
\quad\\
(1,2,1,1) \quad \frac{5!}{1!2!1!1!}=60\\
\quad\\
(2,1,1,1) \quad \frac{5!}{2!1!1!1!}=60\\
\quad\\
C_4^4 \times 240=1 \times 240=240
\quad\\
4+180+600+240=1024
$$
**对上了**
分份的写法可以写成固定数据来加快运算速度
